!function($,itz){itz.wap=itz.wap||{},itz.wap.rqa=function(callback,time){var s=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.setTimeout;return s(callback,time)},itz.wap.clearrqa=function(loop){var c=window.cancelAnimationFrame||window.mozCancelAnimationFrame;"undefined"==typeof c?clearTimeout(loop):c(loop)},itz.wap.countDown=function(op){if(op&&op.obj&&!(op.obj.length<1)){if(!(this instanceof itz.wap.countDown))return new itz.wap.countDown(op);var me=this;me.op=$.extend({start:60,startEl:"",endEl:"",property:"html"},op),me.st=(new Date).getTime(),me.span=me.st,me.cur=me.op.start;var _c=[],_cd=function(){me.op.obj[me.op.property](me.op.startEl+(me.cur<10&&me.cur>0?"0"+me.cur:me.cur)+me.op.endEl);var _td=new Date,_temp=_td.getTime(),_span=_temp-me.st;if(_span<1e3*me.op.start&&_temp-me.span>1e3&&(me.cur=me.op.start-Math.floor(_span/1e3),me.span=_temp),_span>=1e3*me.op.start){for(me.cur=0;_c&&_c.length>0;)itz.wap.clearrqa(_c.pop());return"function"==typeof me.op.callback&&me.op.callback(),void 0}_c.push(itz.wap.rqa(_cd,1e3))};_cd()}},itz.wap.register=function(_options){function showError($errorEle,msg){$errorEle&&$errorEle[0]?($errorEle.html(msg),$errorEle.show()):$(_this.options.otherErrorClass)&&$(_this.options.otherErrorClass)[0]&&($(_this.options.otherErrorClass).html(msg),$(_this.options.otherErrorClass).show())}function hideError($errorEle){$errorEle&&$errorEle[0]?($errorEle.html(),$errorEle.hide()):$(_this.options.otherErrorClass)&&$(_this.options.otherErrorClass)[0]&&($(_this.options.otherErrorClass).html(),$(_this.options.otherErrorClass).hide())}function reflashVcode(){$("input[name=valicode]").val(""),$(_this.options.validCodeReflash).find("img")[0].src="/apiService/captcha/reg?t="+Math.random()}function showVcodeWrapper(){$vcodeWrapper.find("img")[0].src="/apiService/captcha/reg?t="+Math.random(),$vcodeWrapper.slideDown(),needVcode=!0,valid.valicode=!1}function checkIfNeedVcode(){return needVcode?validation.valicode($regForm.find("input[name='valicode']").val())?!0:!1:!0}this.options=$.extend(!0,{checkPhoneUrl:"/apiService/phone/isCertified",sendSmsUrl:"/apiService/phone/getSmsVcode",regUrl:"/wap/user/newreg",form:"#regForm",showClean:!0,cleanClass:".icon-clear",errorClass:".error",otherErrorClass:".other-error",eyeClass:".icon-eye",eyeIcon:".icon-eye",showPwdClass:"enable",getSmsBtn:".phone-valicode-btn",validCodeWrapper:"#valicode-li",validCodeReflash:".vcode-wrapper",regBtn:".reg-btn"},_options);var _this=this,valid={phone:!1,password:!1,valicode:!0,phoneValicode:!1,invitee:!0},needVcode=!1,isSendSms=!1,enableGetSms=1,validation={run:function(name,value){var name=name,value=value;$(_this.options.errorClass).hide(),valid.phone?valid.password?needVcode&&!valid.valicode?(name="valicode",value=$("input[name="+name+"]").val()):valid.phoneValicode||(name="phoneValicode",value=$("input[name="+name+"]").val()):(name="password",value=$("input[name="+name+"]").val()):(name="phone",value=$("input[name="+name+"]").val());var $errorEle=$(_this.options.errorClass+"-"+name);this[name]&&this[name].call(this,$.trim(value),$errorEle)},phone:function(value,$errorEle,errorMsg){var patten=new RegExp(/^1\d{10}$/);return errorMsg?(valid.phone=!1,showError($errorEle,errorMsg),!1):value?patten.test(value)?(valid.phone=!0,hideError($errorEle),!0):(valid.phone=!1,showError($errorEle,"手机号码格式不正确，请重新输入"),!1):(valid.phone=!1,showError($errorEle,"请输入手机号码"),!1)},password:function(value,$errorEle,errorMsg){return errorMsg?(valid.password=!1,showError($errorEle,errorMsg),!1):value?/[^0-9a-zA-Z`~!@#\$%\^&\*()\-=_\+\[\]\\\{\}\|\;':",\.\/<>?]/.test(value)?(valid.password=!1,showError($errorEle,"密码只能包含字母、数字及标点符号（除空格）"),!1):value.length<6||value.length>16?(valid.password=!1,showError($errorEle,"密码请输入6-16位字符"),!1):(valid.password=!0,hideError($errorEle),!0):(valid.password=!1,showError($errorEle,"请输入密码"),!1)},valicode:function(value,$errorEle,errorMsg){return 0==needVcode?!0:errorMsg?(valid.valicode=!1,showError($errorEle,errorMsg),!1):value?/^[\da-zA-Z]{4,10}$/.test(value)?(valid.valicode=!0,hideError($errorEle),!0):(valid.valicode=!1,showError($errorEle,"图形验证码不正确，请重新输入"),!1):(valid.valicode=!1,showError($errorEle,"请输入图形验证码"),!1)},phoneValicode:function(value,$errorEle,errorMsg){return errorMsg?(valid.phoneValicode=!1,showError($errorEle,errorMsg),!1):value?isSendSms?(valid.phoneValicode=!0,hideError($errorEle),!0):(valid.phoneValicode=!1,showError($errorEle,"短信验证码不正确，请重新输入"),!1):(valid.phoneValicode=!1,showError($errorEle,"请输入短信验证码"),!1)},invitee:function(value,$errorEle,errorMsg){return errorMsg?(valid.invitee=!1,showError($errorEle,errorMsg),!1):value?(valid.invitee=!0,hideError($errorEle),!0):(valid.invitee=!0,hideError($errorEle),void 0)}},$regForm=$(this.options.form),$getSmsBtn=$(_this.options.getSmsBtn);$regForm.find("input").bind("input",function(){if(_this.options.showClean){var $iconClear=$(this).siblings(_this.options.cleanClass);""==$(this).val()?$iconClear.hide():$iconClear.show()}var name=$(this).attr("name");valid[name]=!1,"valicode"!=name||needVcode?"invitee"==name&&(valid.invitee=!0):valid.valicode=!0,"phone"==name&&(new RegExp(/^1\d{0,10}/).test($(this).val())?$getSmsBtn.addClass("red"):$getSmsBtn.removeClass("red"))}),this.options.showClean&&$(_this.options.cleanClass).on("click",function(event){event.preventDefault();var $input=$(this).siblings("input");$input.val("");var name=$(this).siblings("input").attr("name");valid[name]=!1,"valicode"!=name||needVcode?"invitee"==name&&(valid.invitee=!0):valid.valicode=!0,$(this).hide(),validation.run(name,$input.val())}),$regForm.find("input").bind("blur",function(){validation.run($(this).attr("name"),$(this).val())});var $showPwd=$(_this.options.eyeClass),$eyeIcon=$(_this.options.eyeIcon),$password=$regForm.find("input[type=password]");$showPwd.on("click",function(){$eyeIcon.toggleClass(_this.options.showPwdClass),$eyeIcon.hasClass(_this.options.showPwdClass)?$password.attr("type","text"):$password.attr("type","password")}),$(_this.options.validCodeReflash).on("click",function(event){event.preventDefault(),reflashVcode()});var $vcodeWrapper=$(_this.options.validCodeWrapper);$regForm.on("click",_this.options.getSmsBtn,function(event){if(event.preventDefault(),!validation.phone($regForm.find("input[name='phone']").val())||!checkIfNeedVcode()||!enableGetSms)return!1;var phoneVal=$.trim($regForm.find("input[name=phone]").val()),valicodeVal=$.trim($regForm.find("input[name=valicode]").val()),$getSmsBtn=$(_this.options.getSmsBtn);enableGetSms=0,send&&send.abort(),$getSmsBtn.html("获取中...");var send=$.ajax({url:_this.options.sendSmsUrl,type:"post",data:{phone:phoneVal,voice:!1,valicode:valicodeVal},dataType:"json",success:function(data){isSendSms=!0,data.code>0?(2008===data.code&&$vcodeWrapper.is(":hidden")?(showVcodeWrapper(),validation.valicode("",$(_this.options.errorClass+"-valicode"),data.info)):2106===data.code||2105===data.code?(validation.valicode("",$(_this.options.errorClass+"-valicode"),data.info),reflashVcode()):2018===data.code?validation.phone("",$(_this.options.errorClass+"-phone"),'该手机号码已注册，立即<a href="/newuser/index/loginWap?username='+phoneVal+'">登录</a>'):validation.phoneValicode("",$(_this.options.errorClass+"-phoneValicode"),data.info),enableGetSms=1,$getSmsBtn.html("获取验证码")):($getSmsBtn.addClass("font_small"),itz.wap.countDown({obj:$getSmsBtn,endEl:"s重新获取",callback:function(){enableGetSms=1,$getSmsBtn.html("重新获取"),$getSmsBtn.removeClass("font_small")}}))},error:function(jqXHR,textStatus){enableGetSms=1;var error="timeout"==textStatus?"请求超时，请重试":"爱亲，网络不畅，请重试";validation.phoneValicode("",$(_this.options.errorClass+"-phoneValicode"),error)}})});var enableSubmit=1;$regForm.on("click",_this.options.regBtn,function(event){if(event.preventDefault(),!valid.phone||!valid.password||needVcode&&!valid.valicode||!valid.phoneValicode||!enableSubmit)return validation.run(),!1;var params=$regForm.serialize();enableSubmit=0;var ajaxObj;ajaxObj&&ajaxObj.abort(),ajaxObj=$.ajax({url:_this.options.regUrl,type:"post",dataType:"json",data:params,timeout:2e4,success:function(data){if(0===data.code){var redirectUrl=window._suc_page||'/wap/user/regSuccess',r_data=data.data;r_data.event_flag&&r_data.event_url&&(redirectUrl=r_data.event_url),location.href=redirectUrl}else{switch(2008===data.code&&$vcodeWrapper.is(":hidden")&&showVcodeWrapper(),needVcode&&reflashVcode(),data.code){case 2006:validation.phone("",$(_this.options.errorClass+"-phone"),data.info);break;case 2012:validation.phone("",$(_this.options.errorClass+"-phone"),data.info);break;case 2018:validation.phone("",$(_this.options.errorClass+"-phone"),data.info);break;case 2007:validation.password("",$(_this.options.errorClass+"-password"),data.info);break;case 2014:validation.password("",$(_this.options.errorClass+"-password"),data.info);break;case 2008:validation.valicode("",$(_this.options.errorClass+"-valicode"),data.info);break;case 2105:validation.valicode("",$(_this.options.errorClass+"-valicode"),data.info);break;case 2106:validation.valicode("",$(_this.options.errorClass+"-valicode"),data.info);break;case 2004:case 2054:validation.invitee("",$(_this.options.errorClass+"-invitee"),data.info);break;case 2043:validation.phoneValicode("",$(_this.options.errorClass+"-phoneValicode"),data.info);break;case 2104:validation.phoneValicode("",$(_this.options.errorClass+"-phoneValicode"),data.info);break;default:$(_this.options.otherErrorClass).html(data.info).show()}enableSubmit=1}},error:function(jqXHR,textStatus){return needVcode&&reflashVcode(),enableSubmit=1,"timeout"==textStatus?($(_this.options.otherErrorClass).html("请求超时，请重试").show(),void 0):($(_this.options.otherErrorClass).html("爱亲，网络不畅，请重试").show(),void 0)}})})}}(jQuery,itz||{});